"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.mapResponsePaymentType = exports.getPaymentTypeFromTypeId = exports.getRefundIdOfCancel = exports.replaceUrl = void 0;
var Card_1 = require("../payments/types/Card");
var Eps_1 = require("../payments/types/Eps");
var Giropay_1 = require("../payments/types/Giropay");
var Paypal_1 = require("../payments/types/Paypal");
var Ideal_1 = require("../payments/types/Ideal");
var Invoice_1 = require("../payments/types/Invoice");
var Prepayment_1 = require("../payments/types/Prepayment");
var Przelewy24_1 = require("../payments/types/Przelewy24");
var SepaDirectDebit_1 = require("../payments/types/SepaDirectDebit");
var SepaDirectDebitSecured_1 = require("../payments/types/SepaDirectDebitSecured");
var Sofort_1 = require("../payments/types/Sofort");
var Pis_1 = require("../payments/types/Pis");
var Alipay_1 = require("../payments/types/Alipay");
var WechatPay_1 = require("../payments/types/WechatPay");
var Bancontact_1 = require("../payments/types/Bancontact");
var InstallmentSecured_1 = require("../payments/types/InstallmentSecured");
var InvoiceSecured_1 = require("../payments/types/InvoiceSecured");
/**
 * Replace URL with parameters: {paymentId} => s-pay-1781
 *
 * @param {string} url
 * @param {*} args
 * @returns
 */
var replaceUrl = function (url, args) {
    var regex = /{([a-zA-Z]+)}/gm;
    var urlReplaced = url.replace(regex, function (matches, item) {
        return args[item] || '';
    });
    return urlReplaced;
};
exports.replaceUrl = replaceUrl;
/**
 * Get refund id from url
 *
 * Ex:
 * <domain>payments/s-pay-3883/charges/s-chg-1/cancels/s-cnl-1
 * It should return s-chg-1 as refund Id of this cancel
 *
 * @param {string} url
 * @returns
 */
var getRefundIdOfCancel = function (url) {
    var regex = /\/([a-zA-Z-0-9]+)\/cancels/gm;
    var matches = regex.exec(url);
    return matches ? matches[1] : '';
};
exports.getRefundIdOfCancel = getRefundIdOfCancel;
/**
 * Get payment type from typeId
 * Ex:
 * crd => Card()
 * gro => GrioPay()
 * @param {string} typeId
 * @returns {AbstractPaymentType}
 */
var getPaymentTypeFromTypeId = function (typeId) {
    if (typeId.length < 5) {
        throw new Error("Type " + typeId + " is currently not supported by the SDK");
    }
    var paymentType = typeId.substring(2, 5);
    switch (paymentType) {
        case 'crd':
            return new Card_1.default();
        case 'eps':
            return new Eps_1.default();
        case 'gro':
            return new Giropay_1.default();
        case 'ppl':
            return new Paypal_1.default();
        case 'idl':
            return new Ideal_1.default();
        case 'ivc':
            return new Invoice_1.default();
        case 'ivg':
        case 'ivf':
        case 'ivs':
            return new InvoiceSecured_1.default();
        case 'ppy':
            return new Prepayment_1.default();
        case 'p24':
            return new Przelewy24_1.default();
        case 'sdd':
            return new SepaDirectDebit_1.default("");
        case 'ddg':
        case 'dds':
            return new SepaDirectDebitSecured_1.default("");
        case 'sft':
            return new Sofort_1.default();
        case 'pis':
            return new Pis_1.default();
        case 'ali':
            return new Alipay_1.default();
        case 'wcp':
            return new WechatPay_1.default();
        case 'bct':
            return new Bancontact_1.default();
        case 'hdd':
        case 'ins':
            return new InstallmentSecured_1.default();
        default:
            throw new Error("Type " + typeId + " is currently not supported by the SDK");
    }
};
exports.getPaymentTypeFromTypeId = getPaymentTypeFromTypeId;
/**
 * Map response with propery payment Type
 *
 * @param {*} response
 * @returns {AbstractPaymentType}
 */
var mapResponsePaymentType = function (response) {
    switch (response.method) {
        case 'card':
            var card = new Card_1.default()
                .setNumber(response.number)
                .setExpiryDate(response.expiryDate)
                .setCVC(response.cvc)
                .setBrand(response.brand)
                .setRecurring(response.recurring);
            if (response.cardHolder) {
                card.setCardHolder(response.cardHolder);
            }
            if (response.cardDetails) {
                card.setCardDetails(response.cardDetails);
            }
            if (response.email) {
                card.setEmail(response.email);
            }
            card.setId(response.id);
            card.setGeoLocation(response.geoLocation);
            return card;
        case 'EPS':
            var eps = new Eps_1.default().setBic(response.bic);
            eps.setId(response.id);
            eps.setGeoLocation(response.geoLocation);
            return eps;
        case 'giropay':
            var giropay = new Giropay_1.default();
            giropay.setId(response.id);
            giropay.setGeoLocation(response.geoLocation);
            return giropay;
        case 'paypal':
            var paypal = new Paypal_1.default();
            paypal.setId(response.id);
            paypal.setGeoLocation(response.geoLocation);
            return paypal;
        case 'ideal':
            var ideal = new Ideal_1.default().setBic(response.bic);
            ideal.setId(response.id);
            ideal.setGeoLocation(response.geoLocation);
            return ideal;
        case 'invoice':
            var invoice = new Invoice_1.default();
            invoice.setId(response.id);
            invoice.setGeoLocation(response.geoLocation);
            return invoice;
        case 'invoice-guaranteed':
        case 'invoice-factoring':
        case 'invoice-secured':
            var invoiceSecured = new InvoiceSecured_1.default();
            invoiceSecured.setId(response.id);
            invoiceSecured.setGeoLocation(response.geoLocation);
            return invoiceSecured;
        case 'przelewy24':
            var przelewy24 = new Przelewy24_1.default();
            przelewy24.setId(response.id);
            przelewy24.setGeoLocation(response.geoLocation);
            return przelewy24;
        case 'prepayment':
            var prepayment = new Prepayment_1.default();
            prepayment.setId(response.id);
            prepayment.setGeoLocation(response.geoLocation);
            return prepayment;
        case 'sepa-direct-debit':
            var sepaDirectDebit = new SepaDirectDebit_1.default(response.iban)
                .setBic(response.bic)
                .setHolder(response.holder);
            sepaDirectDebit.setId(response.id);
            sepaDirectDebit.setGeoLocation(response.geoLocation);
            return sepaDirectDebit;
        case 'sepa-direct-debit-guaranteed':
        case 'sepa-direct-debit-secured':
            var dds = new SepaDirectDebitSecured_1.default(response.iban)
                .setBic(response.bic)
                .setHolder(response.holder);
            dds.setId(response.id);
            dds.setGeoLocation(response.geoLocation);
            return dds;
        case 'sofort':
            var sofort = new Sofort_1.default();
            sofort.setId(response.id);
            sofort.setGeoLocation(response.geoLocation);
            return sofort;
        case 'PIS':
            var pis = new Pis_1.default();
            pis.setId(response.id);
            pis.setGeoLocation(response.geoLocation);
            return pis;
        case 'alipay':
            var alipay = new Alipay_1.default();
            alipay.setId(response.id);
            alipay.setGeoLocation(response.geoLocation);
            return alipay;
        case 'wechatpay':
            var wechatpay = new WechatPay_1.default();
            wechatpay.setId(response.id);
            wechatpay.setGeoLocation(response.geoLocation);
            return wechatpay;
        case 'bancontact':
            var bancontact = new Bancontact_1.default();
            if (response.holder) {
                bancontact.setHolder(response.holder);
            }
            bancontact.setId(response.id);
            bancontact.setGeoLocation(response.geoLocation);
            return bancontact;
        case 'installment-secured':
        case 'hire-purchase-direct-debit':
            var installmentSecured = new InstallmentSecured_1.default();
            installmentSecured
                .setIban(response.iban)
                .setBic(response.bic)
                .setAccountHolder(response.accountHolder)
                .setOrderDate(response.orderDate)
                .setNumberOfRates(response.numberOfRates)
                .setDayOfPurchase(response.dayOfPurchase)
                .setTotalPurchaseAmount(response.totalPurchaseAmount)
                .setTotalInterestAmount(response.totalInterestAmount)
                .setEffectiveInterestRate(response.effectiveInterestRate)
                .setNominalInterestRate(response.nominalInterestRate)
                .setFeeFirstRate(response.feeFirstRate)
                .setFeePerRate(response.feePerRate)
                .setMonthlyRate(response.monthlyRate)
                .setLastRate(response.lastRate)
                .setInvoiceDate(response.invoiceDate)
                .setInvoiceDueDate(response.invoiceDueDate);
            installmentSecured.setId(response.id);
            installmentSecured.setGeoLocation(response.geoLocation);
            return installmentSecured;
        default:
            throw new Error("Type " + response.method + " is currently not supported by the SDK");
    }
};
exports.mapResponsePaymentType = mapResponsePaymentType;
//# sourceMappingURL=Utils.js.map